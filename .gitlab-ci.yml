# GitLab CI/CD pipeline to enforce pre-commit checks
# Alternative to GitHub Actions if using GitLab

stages:
  - security
  - test

pre-commit-checks:
  stage: security
  image: python:3.11

  before_script:
    - pip install pre-commit detect-secrets

  script:
    - pre-commit run --all-files --show-diff-on-failure
    - detect-secrets scan --baseline .secrets.baseline

  cache:
    paths:
      - .cache/pre-commit

  rules:
    - if: '$CI_PIPELINE_SOURCE == "push" || $CI_PIPELINE_SOURCE == "merge_request_event"'

  allow_failure: false  # This makes the check mandatory
